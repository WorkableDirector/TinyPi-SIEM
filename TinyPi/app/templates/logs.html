<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Syslog Explorer • TinyPi SIEM</title>
  <link rel="stylesheet" href="/static/theme.css">
</head>
<body>
<main class="container">
  <nav>
    <ul><li><strong>TinyPi SIEM</strong></li></ul>
    <ul>
      <li><a href="/">Dashboard</a></li>
      <li><a href="/logs" aria-current="page">Logs</a></li>
      <li><a href="/alerts">Alerts</a></li>
      <li><a href="/rules">Rules</a></li>
      <li><a href="/demo">Demo</a></li>
    </ul>
  </nav>

  <section class="hero">
    <p class="section-title">Investigate UniFi gateway syslog</p>
    <h2 class="section-heading">Raw log explorer</h2>
    <p class="tagline">Inspect parsed syslog entries without mixing in alerts. Filters below update the feed instantly so you can drill into the data set before any detections fire.</p>
    <div class="controls" style="margin-top:10px;">
      <a href="/" role="button" class="secondary">Back to Dashboard</a>
      <a href="#top" role="button" class="secondary">Back to top</a>
      <a href="/alerts" role="button" class="secondary">Go to Alerts</a>
    </div>
  </section>

  <form class="filters" method="get" action="/logs" style="align-items:flex-end;">
    <div>
      <label for="search">Contains text</label>
      <input type="search" id="search" name="search" value="{{ filters.search }}" placeholder="ssh, failed password, etc" />
    </div>
    <div>
      <label for="app">App tag</label>
      <input type="text" id="app" name="app" value="{{ filters.app }}" placeholder="sshd, sudo" />
    </div>
    <div>
      <label for="host">Host</label>
      <input type="text" id="host" name="host" value="{{ filters.host }}" placeholder="gateway hostname" />
    </div>
    <div>
      <label for="source">Source label</label>
      <input type="text" id="source" name="source" value="{{ filters.source }}" placeholder="unifi-gateway" />
    </div>
    <div>
      <label for="limit">Max rows</label>
      <input type="number" id="limit" name="limit" value="{{ filters.limit }}" min="10" max="500" />
    </div>
    <div class="controls">
      <button class="primary" type="submit">Apply filters</button>
      <a href="/logs" role="button" class="secondary">Reset</a>
      <button id="refresh-logs" class="secondary" type="button">Refresh</button>
      <button id="clear-logs" class="secondary" type="button">Clear All Syslog</button>
    </div>
  </form>

  <small class="section-title">Showing {{ rows|length }} entr{{ 'y' if rows|length == 1 else 'ies' }} (limit {{ filters.limit }})</small>

  <div class="log-list" style="margin-top:14px;">
      {% for row in rows %}
      <article class="log-card">
          <header>
            <div class="log-meta">
              <span class="pill host">{{ row.src }}</span>
              {% if row.app %}<span class="pill app">{{ row.app }}</span>{% endif %}
            </div>
            <span class="log-time">{{ row.ts }} UTC</span>
          </header>
          <p class="log-summary">{{ row.summary }}</p>
          <hr class="divider" />
          <details>
            <summary>View full payload</summary>
            <pre><code>{{ row.message }}</code></pre>
          </details>
      </article>
      {% else %}
      <p class="empty">No syslog entries yet. Waiting for traffic from the gateway…</p>
      {% endfor %}
  </div>
</main>

<script>
  document.getElementById('clear-logs').addEventListener('click', async function() {
    if (confirm('Are you sure you want to clear all logs?')) {
      try {
        await fetch('/reset/events', { method: 'POST' });
        window.location.href = '/logs';
      } catch (e) {
        console.error("Error clearing logs:", e);
      }
    }
  });

  document.getElementById('refresh-logs').addEventListener('click', function() {
    window.location.href = '/logs';
  });
</script>
</body>
</html>
